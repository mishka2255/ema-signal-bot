<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <title>áƒ¢áƒáƒ˜áƒ›áƒ¤áƒ áƒ”áƒ˜áƒ› áƒ¡áƒ™áƒáƒœáƒ”áƒ áƒ˜</title>
    <style>
        body {
            font-family: "BPG Nino Mtavruli", sans-serif;
            text-align: center;
            padding: 40px;
        }
        h1 {
            font-size: 38px;
        }
        button {
            font-size: 26px;
            padding: 20px 35px;
            margin: 20px;
            border-radius: 12px;
        }
        .info {
            margin-top: 30px;
            font-size: 24px;
        }
        #timer {
            font-size: 28px;
            font-weight: bold;
            margin-top: 15px;
        }
        ul {
            list-style-type: none;
            padding: 0;
        }
        li {
            font-size: 20px;
            margin: 8px;
            padding: 10px;
            border-radius: 8px;
        }
        .strong { background-color: #d4f4dd; font-weight: bold; }
        .medium { background-color: #fff8d6; }
        .weak { background-color: #f8d6d6; }
    </style>
</head>
<body>
    <h1>áƒáƒ˜áƒ áƒ©áƒ˜áƒ” áƒ¢áƒáƒ˜áƒ›áƒ¤áƒ áƒ”áƒ˜áƒ›áƒ˜:</h1>
    <form method="POST" action="/start">
        <button name="timeframe" value="5m">5 áƒ¬áƒ£áƒ—áƒ˜</button>
        <button name="timeframe" value="15m">15 áƒ¬áƒ£áƒ—áƒ˜</button>
    </form>

    <!-- áƒ’áƒáƒ©áƒ”áƒ áƒ”áƒ‘áƒ˜áƒ¡ áƒ¦áƒ˜áƒšáƒáƒ™áƒ˜ -->
    <form method="POST" action="/stop">
        <button type="submit" style="font-size: 22px; padding: 15px 30px; background-color: #ff5555; color: white; border: none; border-radius: 10px;">
            â›” áƒ’áƒáƒ©áƒ”áƒ áƒ”áƒ‘áƒ
        </button>
    </form>

    {% if status.running %}
        <div class="info">
            â³ áƒáƒ áƒáƒªáƒ”áƒ¡áƒ˜ áƒ“áƒáƒ˜áƒ¬áƒ§áƒ â€” áƒ•áƒáƒ›áƒáƒ¬áƒ›áƒ”áƒ‘áƒ— {{ status.tf }} áƒ¢áƒáƒ˜áƒ›áƒ¤áƒ áƒ”áƒ˜áƒ›áƒ–áƒ” {{ status.total }} áƒ¥áƒáƒ˜áƒœáƒ¡...
        </div>
        <div id="timer">â±ï¸ áƒ“áƒáƒ áƒ©áƒ”áƒœáƒ˜áƒšáƒ˜ áƒ“áƒ áƒ: áƒ˜áƒ—áƒ•áƒšáƒ”áƒ‘áƒ...</div>
    {% endif %}

    {% if status.finished %}
        <div class="info" style="color: green; margin-top: 30px;">
            âœ… áƒ¡áƒ™áƒáƒœáƒ˜áƒ áƒ”áƒ‘áƒ áƒ“áƒáƒ¡áƒ áƒ£áƒšáƒ“áƒ!
        </div>
        <div class="info">
            ğŸ•“ áƒ¨áƒ”áƒ¡áƒ áƒ£áƒšáƒ”áƒ‘áƒ£áƒšáƒ˜ áƒ“áƒ áƒ: {{ status.duration // 60 }} áƒ¬áƒ£áƒ—áƒ˜ {{ "%02d"|format(status.duration % 60) }} áƒ¬áƒáƒ›áƒ˜
        </div>
        <div class="info">
            <h3>ğŸ“‹ áƒáƒ¦áƒ›áƒáƒ©áƒ”áƒœáƒ˜áƒšáƒ˜ áƒ¡áƒ˜áƒ’áƒœáƒáƒšáƒ”áƒ‘áƒ˜:</h3>
            <ul>
                {% for item in status.results %}
                    {% set indicators = item.count('+') %}
                    <li class="{{ 'strong' if indicators >= 4 else 'medium' if indicators >= 2 else 'weak' }}">
                        {{ item }} {% if indicators >= 1 %}[{{ 'â­' * indicators }}]{% endif %}
                    </li>
                {% endfor %}
            </ul>
        </div>
    {% endif %}

    <script>
        let remaining = 0;
        const timerElem = document.getElementById("timer");

        function updateTimer() {
            fetch("/status")
                .then(response => response.json())
                .then(data => {
                    if (data.running && !data.finished) {
                        const estimatedTotal = Math.round(data.total * 0.4);
                        const remainingSeconds = estimatedTotal - data.duration;
                        if (remainingSeconds > 0) {
                            let mins = Math.floor(remainingSeconds / 60);
                            let secs = remainingSeconds % 60;
                            timerElem.innerText = `â±ï¸ áƒ“áƒáƒ áƒ©áƒ”áƒœáƒ˜áƒšáƒ˜ áƒ“áƒ áƒ: ${mins} áƒ¬áƒ£áƒ—áƒ˜ ${secs.toString().padStart(2, '0')} áƒ¬áƒáƒ›áƒ˜`;
                        } else {
                            timerElem.innerText = `â±ï¸ áƒ“áƒáƒ¡áƒ áƒ£áƒšáƒ”áƒ‘áƒ˜áƒ¡ áƒ›áƒáƒšáƒáƒ“áƒ˜áƒœáƒ˜...`;
                        }
                        setTimeout(updateTimer, 1000);
                    } else if (data.finished) {
                        location.reload();
                    }
                });
        }

        {% if status.running and not status.finished %}
            updateTimer();
        {% endif %}
    </script>
</body>
</html>
